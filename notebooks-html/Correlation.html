<div id="ipython-notebook">
            <a class="interact-button" href="http://data8.berkeley.edu/hub/interact?repo=textbook&path=notebooks/baby.csv&path=notebooks/sat2014.csv&path=notebooks/Correlation.ipynb">Interact</a>
            
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\(','\)']],
      processEscapes: true
    }
  });
</script>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Measuring-the-relation-between-two-variables">Measuring the relation between two variables<a class="anchor-link" href="#Measuring-the-relation-between-two-variables">¶</a></h2></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the last chapter, we began developing a method that would allow us to estimate the birth weight of babies based on the number of gestational days. In this chapter, we develop a more general approach to measuring the relation between two variables and estimating the value of one variable given the value of another.</p>
<p>Our proposed estimate in the example of birth weights was simple:</p>
<ul>
<li>Find the ratio of the birth weight to gestational days for each baby in the sample. </li>
<li>Find the median of the ratios. </li>
<li>For a new baby, multiply the number of gestational days by that median. This is our estimate of the baby's birth weight.</li>
</ul>
<p>Here are the data; the column <code>r_bwt_gd</code> contains the ratio of birth weight to gestational days.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">baby</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s">'baby.csv'</span><span class="p">)</span>
<span class="n">baby</span><span class="p">[</span><span class="s">'r_bwt_gd'</span><span class="p">]</span> <span class="o">=</span> <span class="n">baby</span><span class="p">[</span><span class="s">'birthwt'</span><span class="p">]</span><span class="o">/</span><span class="n">baby</span><span class="p">[</span><span class="s">'gest_days'</span><span class="p">]</span>
<span class="n">baby</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>birthwt</th> <th>gest_days</th> <th>mat_age</th> <th>mat_ht</th> <th>mat_pw</th> <th>m_smoker</th> <th>r_bwt_gd</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>120    </td> <td>284      </td> <td>27     </td> <td>62    </td> <td>100   </td> <td>0       </td> <td>0.422535</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>113    </td> <td>282      </td> <td>33     </td> <td>64    </td> <td>135   </td> <td>0       </td> <td>0.400709</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>128    </td> <td>279      </td> <td>28     </td> <td>64    </td> <td>115   </td> <td>1       </td> <td>0.458781</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>108    </td> <td>282      </td> <td>23     </td> <td>67    </td> <td>125   </td> <td>1       </td> <td>0.382979</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>136    </td> <td>286      </td> <td>25     </td> <td>62    </td> <td>93    </td> <td>0       </td> <td>0.475524</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>138    </td> <td>244      </td> <td>33     </td> <td>62    </td> <td>178   </td> <td>0       </td> <td>0.565574</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>132    </td> <td>245      </td> <td>23     </td> <td>65    </td> <td>140   </td> <td>0       </td> <td>0.538776</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>120    </td> <td>289      </td> <td>25     </td> <td>62    </td> <td>125   </td> <td>0       </td> <td>0.415225</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>143    </td> <td>299      </td> <td>30     </td> <td>66    </td> <td>136   </td> <td>1       </td> <td>0.478261</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>140    </td> <td>351      </td> <td>27     </td> <td>68    </td> <td>120   </td> <td>0       </td> <td>0.39886 </td>
        </tr>
    </tbody>
</table>
<p>... (1164 rows omitted)</p></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The median of the ratios is just about 0.429 ounces per day:</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">baby</span><span class="p">[</span><span class="s">'r_bwt_gd'</span><span class="p">])</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.42907801418439717</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So we can construct our proposed estimate by multiplying the number of gestational days of each baby by 0.429. The column <code>est_wt</code> contains these estimates.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">baby</span><span class="p">[</span><span class="s">'est_bwt'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.429</span><span class="o">*</span><span class="n">baby</span><span class="p">[</span><span class="s">'gest_days'</span><span class="p">]</span>
<span class="n">baby</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'r_bwt_gd'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>birthwt</th> <th>gest_days</th> <th>mat_age</th> <th>mat_ht</th> <th>mat_pw</th> <th>m_smoker</th> <th>est_bwt</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>120    </td> <td>284      </td> <td>27     </td> <td>62    </td> <td>100   </td> <td>0       </td> <td>121.836</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>113    </td> <td>282      </td> <td>33     </td> <td>64    </td> <td>135   </td> <td>0       </td> <td>120.978</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>128    </td> <td>279      </td> <td>28     </td> <td>64    </td> <td>115   </td> <td>1       </td> <td>119.691</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>108    </td> <td>282      </td> <td>23     </td> <td>67    </td> <td>125   </td> <td>1       </td> <td>120.978</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>136    </td> <td>286      </td> <td>25     </td> <td>62    </td> <td>93    </td> <td>0       </td> <td>122.694</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>138    </td> <td>244      </td> <td>33     </td> <td>62    </td> <td>178   </td> <td>0       </td> <td>104.676</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>132    </td> <td>245      </td> <td>23     </td> <td>65    </td> <td>140   </td> <td>0       </td> <td>105.105</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>120    </td> <td>289      </td> <td>25     </td> <td>62    </td> <td>125   </td> <td>0       </td> <td>123.981</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>143    </td> <td>299      </td> <td>30     </td> <td>66    </td> <td>136   </td> <td>1       </td> <td>128.271</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>140    </td> <td>351      </td> <td>27     </td> <td>68    </td> <td>120   </td> <td>0       </td> <td>150.579</td>
        </tr>
    </tbody>
</table>
<p>... (1164 rows omitted)</p></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Because of the way they are constructed – by multiplying the gestational days by a constant – The estimates all lie on a straight line.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">bb0</span> <span class="o">=</span> <span class="n">baby</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s">'gest_days'</span><span class="p">,</span> <span class="s">'est_bwt'</span><span class="p">])</span>
<span class="n">bb0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s">'gest_days'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'gestational days'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'estimated birth weight'</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_10_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A natural question to ask is, "How good are these estimates?" To get a sense of the answer, let us visualize the data by drawing a <em>scatter plot</em> of birth weight versus gestational days. The scatter plot consists of one point for each of the 1,174 babies in the sample. The horizontal axis represents the number of gestational days and the vertical axis represents the birth weight.</p>
<p>The plot is generated by using a <code>Table</code> method called <code>scatter</code>. The argument is the label of the column that contains the values to be plotted on the horizontal axis. For each of the other columns in the table, a scatter diagram is produced with the corresponding variable on the vertical axis. To generate just one scatter plot, therefore, we start by selecting only the variables that we need.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">gd_bwt</span> <span class="o">=</span> <span class="n">baby</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s">'gest_days'</span><span class="p">,</span> <span class="s">'birthwt'</span><span class="p">])</span>
<span class="n">gd_bwt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s">'gest_days'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'gestational days'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'birth weight'</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_12_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How good are the estimates that we calculated? To get a sense of this, we will re-draw the scatter plot and overlay the line of estimates. This can be done by using the argument <code>overlay=True</code> when we call <code>scatter</code>.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">gd_bwt_est</span> <span class="o">=</span> <span class="n">baby</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s">'gest_days'</span><span class="p">,</span> <span class="s">'birthwt'</span><span class="p">,</span> <span class="s">'est_bwt'</span><span class="p">])</span>
<span class="n">gd_bwt_est</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s">'gest_days'</span><span class="p">,</span> <span class="n">overlay</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'gestational days'</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_14_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The line appears to be roughly in the center of the scatter diagram; if we use the line for estimation, the amount of over-estimation will be comparable to the amount of under-estimation, roughly speaking. This is a natural criterion for determining a "good" straight line of estimates.</p>
<p>Let us see if we can formalize this idea and create a "best" straight line of estimates.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To see roughly where such a line must lie, we will start by attempting to estimate maternal pregnancy weight based on the mother's height. The heights have been measured to the nearest inch, resulting in the vertical stripes in the scatter plot.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">ht_pw</span> <span class="o">=</span> <span class="n">baby</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s">'mat_ht'</span><span class="p">,</span> <span class="s">'mat_pw'</span><span class="p">])</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ht_pw</span><span class="p">[</span><span class="s">'mat_ht'</span><span class="p">],</span> <span class="n">ht_pw</span><span class="p">[</span><span class="s">'mat_pw'</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'gold'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'height (inches)'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'pregnancy weight (pounds)'</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_18_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Suppose we know that one of the women is 65 inches tall. What would be our estimate for her pregnancy weight?</p>
<p>We know that the point corresponding to this woman must be on the vertical strip at 65 inches. A natural estimate of her pregnancy weight is the average of the weights in that strip; the rough size of the error in this estimate will be the SD of the weights in the strip.</p>
<p>For a woman who is 60 inches tall, our estimate of pregnancy weight would be the average of the weights in the vertical strip at 60 inches. And so on.</p>
<p>Here are the average pregnancy weights for all the values of the heights.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">v_means</span> <span class="o">=</span> <span class="n">ht_pw</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'mat_ht'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="n">v_means</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>mat_ht</th> <th>mat_pw mean</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>53    </td> <td>110        </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>54    </td> <td>156        </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>56    </td> <td>93         </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>57    </td> <td>98         </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>58    </td> <td>112.8      </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>59    </td> <td>109.208    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>60    </td> <td>109.556    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>61    </td> <td>118.556    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>62    </td> <td>120.756    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>63    </td> <td>125.894    </td>
        </tr>
    </tbody>
</table>
<p>... (9 rows omitted)</p></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the figure below, these averages are overlaid on the scatter plot of pregnancy weight versus height, and appear as green dots at the averages of the vertical strips. The graph of green dots is called the <em>graph of averages</em>. A graph of averages shows the average of the variable on the vertical axis, for each value of the variable on the horizontal axis. It can be used for estimating the variable on the vertical axis, given the variable on the horizontal.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">baby</span><span class="p">[</span><span class="s">'mat_ht'</span><span class="p">],</span> <span class="n">baby</span><span class="p">[</span><span class="s">'mat_pw'</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'gold'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">v_means</span><span class="p">[</span><span class="s">'mat_ht'</span><span class="p">],</span> <span class="n">v_means</span><span class="p">[</span><span class="s">'mat_pw mean'</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">'g'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'height (inches)'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'pregnancy weight (pounds)'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Graph of Averages'</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_22_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For these two variables, the graph of averages looks roughly linear: the green dots are fairly close to a straight line for much of the scatter. That straight line is the "best" straight line for estimating pregnancy weight based on height.</p>
<p>To identify the line more precisely, let us examine the oval or <em>football shaped</em> scatter plot.</p>
<p>First, we note that the position of the line is a property of the shape of the scatter, and is not affected by the units in which the heights and weights were measured. Therefore, we will measure both variables in standard units.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Identifying-the-line-that-goes-through-the-graph-of-averages">Identifying the line that goes through the graph of averages<a class="anchor-link" href="#Identifying-the-line-that-goes-through-the-graph-of-averages">¶</a></h2></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">x_demo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">z_demo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">y_demo</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x_demo</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">.</span><span class="mi">75</span><span class="p">)</span><span class="o">*</span><span class="n">z_demo</span>
<span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_demo</span><span class="p">,</span> <span class="n">y_demo</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s">'equal'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="mf">0.6</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="mf">0.6</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">'g'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'k'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'x in standard units'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'y in standard units'</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_25_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is a football shaped scatter plot. We will follow the usual convention of calling the variable along the horizontal axis $x$ and the variable on the vertical axis $y$. Both variables are in standard units. This implies that the center of the football, corresponding to the point where both variables are at their average, is the origin (0, 0).</p>
<p>Because of the symmetry of the figure, resulting from both variables being measured in standard units, it is natural to see whether the 45 degree line is the best line for estimation. The 45 degree line has been drawn in red. For points on the red line, the value of $x$ in standard units is equal to the value of $y$ in standard units.</p>
<p>Suppose the given value of $x$ is at the average, in other words at 0 on the standard units scale. The points corresponding to that value of $x$ are on the vertical strip at $x$ equal to 0 standard units. The average of the values of $y$ in that strip can be seen to be at 0, by symmetry. So the straight line of estimates should pass through (0, 0).</p>
<p>A careful look at the vertical strips shows that the red line does not work for estimating $y$ based on other values of $x$. For example, suppose the value of $x$ is 1.5 standard units. The black vertical line corresponds to this value of $x$. The points on the scatter whose value of $x$ is 1.5 standard units are the blue dots on the black line; their values on the vertical scale range from about 2 to about 3. It is clear from the figure that the red line does not pass through the average of these points; the red line is too steep.</p>
<p>To get to the average of the vertical strip at $x$ equal to 1.5 standard units, we have to come down from the red line to the center of the strip. The green line is at that point; it has been drawn by connecting the center of the strip to the point (0, 0) and then extending the line on both sides.</p>
<p>The scatter plot is linear, so the green line picks off the centers of the vertical strips. It is the line that should be used to estimate $y$ based on $x$ when both variables are in standard units.</p>
<p>The slope of the red line is equal to 1. The green line is less steep, and so its slope is less than 1. Because it is sloping upwards in the figure, we have established that its slope is between 0 and 1.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Summary.</strong> When both variables are measured in standard units, the best line for estimating $y$ based on $x$ is less steep than the 45 degree line and thus has slope less than one. The discussion above was based on a scatter plot sloping upwards, and so the slope of the best line is a number between 0 and 1. For scatter diagrams sloping downwards, the slope would be a number between 0 and -1. For the slope to be close to -1 or 1, the red and green lines must be close, or in other words, the scatter diagram must be tightly clustered around a straight line.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-Correlation-Coefficient">The Correlation Coefficient<a class="anchor-link" href="#The-Correlation-Coefficient">¶</a></h2><p>This number between -1 and 1 is called the <em>correlation coefficient</em> and is said to measure the <em>correlation</em> between the two variables.</p>
<ul>
<li>The correlation coefficient $r$ is a number between $-1$ and 1.</li>
<li>When both the variables are measured in standard units, $r$ is the slope of the "best straight line" for estimating $y$ based on $x$.</li>
<li>$r$ measures the extent to which the scatter plot clusters around a straight line of positive or negative slope.</li>
</ul></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The function <code>football</code> takes a value of $r$ as its argument and generates a football shaped scatter plot with correlation roughly $r$. The red line is the 45 degree line $y=x$, corresponding to points that are the same number of standard units in both variables. The green line, $y = rx$, is a smoothed version of the graph of averages. Points on the green line correspond to our estimates of the variable on the vertical axis, given values on the horizontal.</p>
<p>Call <code>football</code> a few times, with different values of $r$ as the argument, and see how the football changes. Positive $r$ corresponds to positive association: above-average values of one variable are associated with above-average values of the other, and the scatter plot slopes upwards.</p>
<p>Notice also that the bigger the absolute value of $r$, the more clustered the points are around the green line of averages, and the closer the green line is to the red line of equal standard units.</p>
<p>When $r=1$ the scatter plot is perfectly linear and slopes upward. When $r=-1$, the scatter plot is perfectly linear and slopes downward. When $r=0$, the scatter plot is a formless cloud around the horizontal axis, and the variables are said to be <em>uncorrelated</em>.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># Football shaped scatter, both axes in standard units</span>
<span class="c"># Argument of function: correlation coefficient r</span>
<span class="c"># red line: slope = 1 (or -1)</span>
<span class="c"># green line: smoothed graph of averages, slope = r</span>
<span class="c"># Use the green line for estimating y based on x</span>

<span class="n">football</span><span class="p">(</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_30_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">football</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_31_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">football</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_32_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">football</span><span class="p">(</span><span class="o">-</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_33_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculating-$r$">Calculating $r$<a class="anchor-link" href="#Calculating-$r$">¶</a></h3><p>The formula for $r$ is not apparent from our observations so far; it has a mathematical basis that is outside the scope of this class. However, the calculation is straightforward and helps us understand several of the properties of $r$.</p>
<p><strong>Formula for $r$</strong>:</p>
<ul>
<li>$r$ is the average of the products of the two variables, when both variables are measured in standard units.</li>
</ul>
<p>Here are the steps in the calculation. We will apply the steps to a simple table of values of $x$ and $y$.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="p">[</span><span class="s">'x'</span><span class="p">,</span><span class="s">'y'</span><span class="p">])</span>
<span class="n">t</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>x</th> <th>y</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1   </td> <td>2   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>2   </td> <td>3   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>3   </td> <td>1   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>4   </td> <td>5   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>5   </td> <td>2   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>6   </td> <td>7   </td>
        </tr>
    </tbody>
</table></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Based on the scatter plot, we expect that $r$ will be positive but not equal to 1.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'x'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'y'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_37_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Step 1.</strong> Convert each variable to standard units.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">t</span><span class="p">[</span><span class="s">'x_su'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'x'</span><span class="p">]))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'x'</span><span class="p">])</span>
<span class="n">t</span><span class="p">[</span><span class="s">'y_su'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'y'</span><span class="p">]))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'y'</span><span class="p">])</span>
<span class="n">t</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>x</th> <th>y</th> <th>x_su</th> <th>y_su</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1   </td> <td>2   </td> <td>-1.46385</td> <td>-0.648886</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>2   </td> <td>3   </td> <td>-0.87831</td> <td>-0.162221</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>3   </td> <td>1   </td> <td>-0.29277</td> <td>-1.13555 </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>4   </td> <td>5   </td> <td>0.29277 </td> <td>0.811107 </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>5   </td> <td>2   </td> <td>0.87831 </td> <td>-0.648886</td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>6   </td> <td>7   </td> <td>1.46385 </td> <td>1.78444  </td>
        </tr>
    </tbody>
</table></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Step 2.</strong> Multiply each pair of standard units.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">t</span><span class="p">[</span><span class="s">'su_product'</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s">'x_su'</span><span class="p">]</span><span class="o">*</span><span class="n">t</span><span class="p">[</span><span class="s">'y_su'</span><span class="p">]</span>
<span class="n">t</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>x</th> <th>y</th> <th>x_su</th> <th>y_su</th> <th>su_product</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1   </td> <td>2   </td> <td>-1.46385</td> <td>-0.648886</td> <td>0.949871  </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>2   </td> <td>3   </td> <td>-0.87831</td> <td>-0.162221</td> <td>0.142481  </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>3   </td> <td>1   </td> <td>-0.29277</td> <td>-1.13555 </td> <td>0.332455  </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>4   </td> <td>5   </td> <td>0.29277 </td> <td>0.811107 </td> <td>0.237468  </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>5   </td> <td>2   </td> <td>0.87831 </td> <td>-0.648886</td> <td>-0.569923 </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>6   </td> <td>7   </td> <td>1.46385 </td> <td>1.78444  </td> <td>2.61215   </td>
        </tr>
    </tbody>
</table></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Step 3.</strong> $r$ is the average of the products computed in Step 2.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># r is the average of the products of standard units</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'su_product'</span><span class="p">])</span>
<span class="n">r</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.61741639718977093</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As expected, $r$ is positive but not equal to 1.</p>
<p>The calculation shows that:</p>
<ul>
<li>$r$ is a pure number; it has no units. This is because $r$ is based on standard units.</li>
<li>$r$ is unaffected by changing the units on either axis. This too is because $r$ is based on standard units.</li>
<li>$r$ is unaffected by switching the axes. Algebraically, this is because the product of standard units does not depend on which variable is called $x$ and which $y$. Geometrically, switching axes reflects the scatter plot about the line $y=x$, but does not change the amount of clustering nor the sign of the association.</li>
</ul></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'y'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'x'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_45_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The NumPy method <code>corrcoef</code> can be used to calculate $r$. The arguments are an array containing the values of $x$ and another containing the corresponding values of $y$. The program evaluates to a <em>correlation matrix</em>, which is this case is a 2x2 table indexed by $x$ and $y$. The top left element is the correlation between $x$ and $x$, and hence is 1. The top right element is the correlation between $x$ and $y$, which is equal to the correlation between $y$ and $x$ displayed on the bottom left. The bottom right element is 1, the correlation between $y$ and $y$.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s">'y'</span><span class="p">])</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>array([[ 1.       ,  0.6174164],
       [ 0.6174164,  1.       ]])</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For the purposes of this class, correlation matrices are unnecessary. We will define our own function <code>corr</code> to compute $r$, based on the formula that we used above. The arguments are the name of the table and the labels of the columns containing the two variables. The function returns the mean of the products of standard units, which is $r$.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">corr</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">column_A</span><span class="p">,</span> <span class="n">column_B</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">column_A</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">column_B</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(((</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>
</pre></div></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here are examples of calling the function. Notice that it gives the same answer to the correlation between $x$ and $y$ as we got by using <code>np.corrcoef</code> and earlier by direct application of the formula for $r$. Notice also that the correlation between maternal age and birth weight is very low, confirming the lack of any upward or downward trend in the scatter diagram.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">corr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.61741639718977093</pre></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">corr</span><span class="p">(</span><span class="n">baby</span><span class="p">,</span> <span class="s">'birthwt'</span><span class="p">,</span> <span class="s">'gest_days'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.40754279338885108</pre></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">corr</span><span class="p">(</span><span class="n">baby</span><span class="p">,</span> <span class="s">'birthwt'</span><span class="p">,</span> <span class="s">'mat_age'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.026982911002929499</pre></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">baby</span><span class="p">[</span><span class="s">'mat_age'</span><span class="p">],</span> <span class="n">baby</span><span class="p">[</span><span class="s">'birthwt'</span><span class="p">])</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"mother's age"</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'birth weight'</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_54_0.png"/></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Properties-of-Correlation">Properties of Correlation<a class="anchor-link" href="#Properties-of-Correlation">¶</a></h3><p>Correlation is a simple and powerful concept, but it is sometimes misused. Before using $r$, it is important to be aware of the following points.</p>
<ul>
<li><p>Correlation only measures association. Correlation does not imply causation. Though the correlation between the weight and the math ability of children in a school district may be positive, that does not mean that doing math makes children heavier or that putting on weight improves the children's math skills. Age is a confounding variable: older children are both heavier and better at math than younger children, on average.</p>
</li>
<li><p>Correlation measures <strong>linear</strong> association. Variables that have strong non-linear association might have very low correlation. Here is an example of variables that have a perfect quadratic relation $y = x^2$ but have correlation equal to 0.</p>
</li>
</ul></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tsq</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">],</span>
           <span class="p">[</span><span class="s">'x'</span><span class="p">,</span><span class="s">'y'</span><span class="p">])</span>
<span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tsq</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">tsq</span><span class="p">[</span><span class="s">'y'</span><span class="p">])</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'x'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'y'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_56_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">corr</span><span class="p">(</span><span class="n">tsq</span><span class="p">,</span> <span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.0</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Outliers can have a big effect on correlation. Here is an example where a scatter plot for which $r$ is equal to 1 is turned into a plot for which $r$ is equal to 0, by the addition of just one outlying point.</li>
</ul></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]],</span> <span class="p">[</span><span class="s">'x'</span><span class="p">,</span><span class="s">'y'</span><span class="p">])</span>
<span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_59_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">corr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>1.0</pre></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">t_outlier</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="s">'x'</span><span class="p">,</span><span class="s">'y'</span><span class="p">])</span>
<span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t_outlier</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">t_outlier</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_61_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">corr</span><span class="p">(</span><span class="n">t_outlier</span><span class="p">,</span> <span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.0</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Correlations based on aggregated data can be misleading. As an example, here are data on the Critical Reading and Math SAT scores in 2014. There is one point for each of the 50 states and one for Washington, D.C. The column <code>Participation Rate</code> contains the percent of high school seniors who took the test. The next three columns show the average score in the state on each portion of the test, and the final column is the average of the total scores on the test.</li>
</ul></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">sat2014</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s">'sat2014.csv'</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">'State'</span><span class="p">)</span>
<span class="n">sat2014</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>State</th> <th>Participation Rate</th> <th>Critical Reading</th> <th>Math</th> <th>Writing</th> <th>Combined</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Alabama             </td> <td>6.7               </td> <td>547             </td> <td>538 </td> <td>532    </td> <td>1617    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Alaska              </td> <td>54.2              </td> <td>507             </td> <td>503 </td> <td>475    </td> <td>1485    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Arizona             </td> <td>36.4              </td> <td>522             </td> <td>525 </td> <td>500    </td> <td>1547    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Arkansas            </td> <td>4.2               </td> <td>573             </td> <td>571 </td> <td>554    </td> <td>1698    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>California          </td> <td>60.3              </td> <td>498             </td> <td>510 </td> <td>496    </td> <td>1504    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Colorado            </td> <td>14.3              </td> <td>582             </td> <td>586 </td> <td>567    </td> <td>1735    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Connecticut         </td> <td>88.4              </td> <td>507             </td> <td>510 </td> <td>508    </td> <td>1525    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Delaware            </td> <td>100               </td> <td>456             </td> <td>459 </td> <td>444    </td> <td>1359    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>District of Columbia</td> <td>100               </td> <td>440             </td> <td>438 </td> <td>431    </td> <td>1309    </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>Florida             </td> <td>72.2              </td> <td>491             </td> <td>485 </td> <td>472    </td> <td>1448    </td>
        </tr>
    </tbody>
</table>
<p>... (41 rows omitted)</p></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The scatter diagram of Math scores versus Critical Reading scores is very tightly clustered around a straight line; the correlation is close to 0.985.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sat2014</span><span class="p">[</span><span class="s">'Critical Reading'</span><span class="p">],</span> <span class="n">sat2014</span><span class="p">[</span><span class="s">'Math'</span><span class="p">])</span>
<span class="n">plots</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Critical Reading'</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Math'</span><span class="p">)</span>
<span class="k">None</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Correlation_66_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">corr</span><span class="p">(</span><span class="n">sat2014</span><span class="p">,</span> <span class="s">'Critical Reading'</span><span class="p">,</span> <span class="s">'Math'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0.98475584110674341</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is important to note that this does not reflect the strength of the relation between the Math and Critical Reading scores of students. States don't take tests – students do. The data in the table have been created by lumping all the students in each state into a single point at the average values of the two variables in that state. But not all students in the state will be at that point, as students vary in their performance. If you plot a point for each student instead of just one for each state, there will be a cloud of points around each point in the figure above. The overall picture will be more fuzzy. The correlation between the Math and Critical Reading scores of the students will be lower than the value calculated based on state averages.</p>
<p>Correlations based on aggregates and averages are called <em>ecological correlations</em> and are frequently reported. As we have just seen, they must be interpreted with care.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Serious-or-tongue-in-cheek?">Serious or tongue-in-cheek?<a class="anchor-link" href="#Serious-or-tongue-in-cheek?">¶</a></h3><p>In 2012, a <a href="http://www.biostat.jhsph.edu/courses/bio621/misc/Chocolate%20consumption%20cognitive%20function%20and%20nobel%20laurates%20%28NEJM%29.pdf">paper</a> in the respected New England Journal of Medicine examined the relation between chocolate consumption and Nobel Prizes in a group of countries. The <a href="http://blogs.scientificamerican.com/the-curious-wavefunction/chocolate-consumption-and-nobel-prizes-a-bizarre-juxtaposition-if-there-ever-was-one/">Scientific American</a> responded seriously;
<a href="http://www.reuters.com/article/2012/10/10/us-eat-chocolate-win-the-nobel-prize-idUSBRE8991MS20121010#vFdfFkbPVlilSjsB.97">others</a> were more relaxed. The paper included the following graph:</p>
<p><img alt="choc_Nobel" src="assets/images/chocoNobel.png"/></p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See what you think about the analysis and also about the Reuters report that said, "The p-value Messerli calculated was 0.0001. 'This means that the odds of this being due to chance are less than 1 in 10,000," he said."</p></div></div></div>