<div id="ipython-notebook">
            <a class="interact-button" href="http://data8.berkeley.edu/hub/interact?repo=textbook&path=notebooks/Iteration.ipynb">Interact</a>
            <div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We've seen how data is represented as a sequence of values.  What if we want to do something once for each value in the sequence?  For instance, maybe we want to compute the sum of a sequence of numbers.  How can we do that?  The answer is to use iteration: in particular, we use a Python construct called a <code>for</code>-loop.  Check it out:</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tbl</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">]],</span> <span class="p">[</span><span class="s">'num'</span><span class="p">])</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tbl</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>num</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>2   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>3   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>10  </td>
        </tr>
    </tbody>
</table></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tbl</span><span class="p">[</span><span class="s">'num'</span><span class="p">]</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>array([ 2,  3, 10])</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>OK, so that gives us a sequence of numbers (the sequence 5, 6, 11).</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tbl</span><span class="p">[</span><span class="s">'num'</span><span class="p">]:</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">+</span> <span class="n">i</span>
<span class="n">total</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>15</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice how this works.  We start out by setting <code>total</code> to hold the number 0.  Then, we go through the sequence, one by one.  For each number in the sequence, we temporarily set <code>i</code> to hold that number, and then we execute the statement <code>total = total + i</code>.  This statement replaces the previous value of <code>total</code> with <code>total + i</code>.  In other words, it adds <code>i</code> to the current running total.  Once we've gone through the entire sequence, <code>total</code> holds the sum of all of the numbers in the sequence.</p>
<p>In short, a <code>for</code>-loop lets you do something once for each item in a sequence.  It <em>iterates</em> through the sequence, examining each value one at a time, and does something for each.</p>
<p>In this case, we could have accomplished the same task without a <code>for</code>-loop: there is a <code>numpy</code> function we could have used (<code>np.sum</code>) to do this for us.  That's not unusual; it's not unusual that there might be multiple ways to accomplish the same task.  But sometimes there is no existing Python function that does exactly what we want, and that's when it is good to have tools we can use to do what we want.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Repetition">Repetition<a class="anchor-link" href="#Repetition">¶</a></h2></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A special case of iteration is where we want to do some simple task multiple times: say, 10 times.  You could copy-paste the code 10 times, but that gets a little tedious, and if you wanted to do it a thousand times (or a million times), forget it.  Also, copy-pasting code is usually a bad idea: what if you realize you want to change some piece of it?  Then you'll need to laboriously change each copy of it.  Boooring!</p>
<p>A better solution is to use a <code>for</code>-loop for this purpose.  The trick is to choose a sequence of length 10, and then iterate over the sequence: do the task once for each item in the sequence.  It doesn't really matter what we put in the sequence; any sequence will do.</p>
<p>However, there is a standard idiom for what to put in the sequence.  The typical solution is to create a sequence of consecutive integers, starting at 0, and iterate over it.  If we wanted to do something 1000 times, we'd create a sequence holding the values 0, 1, 2, 3, 4, 5, 6, 7, 8, 9.  Why 9? (and not 10?)  Because that's where we need to end, if we want the list to have 10 items.  (Why not use 1, 2, .., 10?  I'm tempted to say, because computer scientists are just a tad odd.  Actually, there are good reasons for this idiom, but don't worry about it right now.)</p>
<p>How do we create a sequence 0, 1, .., 9?  It turns out we've already seen how to do that: use <code>np.arange()</code>.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, now I'm ready to show you how to do something 10 times:</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">'Go Bears!'</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Go Bears!
Go Bears!
Go Bears!
Go Bears!
Go Bears!
Go Bears!
Go Bears!
Go Bears!
Go Bears!
Go Bears!
</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Strings are sequences, too:</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">'CAL'</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">'Give me a '</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Give me a C
Give me a A
Give me a L
</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this class, you're going to use this a lot for simulation.  For instance, you might code up a way to simulate one round of some gambling game; then you can use a <code>for</code>-loop to repeat the simulation thousands of times and see how often we win.  The great thing about computers is that they're incredibly good at doing a small task repeatedly many times, so this is a perfect match for what they're good at.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Randomized-response">Randomized response<a class="anchor-link" href="#Randomized-response">¶</a></h2></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, we'll look at a technique that was designed several decades ago to help conduct surveys of sensitive subjects.  Researchers wanted to ask participants a few questions: Have you ever had an affair?  Do you secretly think you are gay?  Have you ever shoplifted?  Have you ever sung a Justin Bieber song in the shower?  They figured that some people might not respond honestly, because of the social stigma associated with answering "yes".  So, they came up with a clever way to estimate the fraction of the population who are in the "yes" camp, without violating anyone's privacy.</p>
<p>Here's the idea.  We'll instruct the respondent to roll a fair 6-sided die, secretly, where no one else can see it.  If the die comes up 1, 2, 3, or 4, then respondent is supposed to answer honestly.  If it comes up 5 or 6, the respondent is supposed to answer the <em>opposite</em> of what their true answer would be.  But, they shouldn't reveal what came up on their die.</p>
<p>Notice how clever this is.  Even if the person says "yes", that doesn't necessarily mean their true answer is "yes" -- they might very well have just rolled a 5 or 6.  So the responses to the survey don't reveal any one individual's true answer.  Yet, in aggregate, the responses give enough information that we can get a pretty good estimate of the fraction of people whose true answer is "yes".</p>
<p>Let's try a simulation, so we can see how this works.  We'll write some code to perform this operation.  First, a function to simulate rolling one die:</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">dicetbl</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span> <span class="p">[</span><span class="s">'roll'</span><span class="p">])</span>
<span class="n">dicetbl</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>roll</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>2   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>3   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>4   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>5   </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>6   </td>
        </tr>
    </tbody>
</table></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">rollonedie</span><span class="p">():</span>
    <span class="n">tbl</span> <span class="o">=</span> <span class="n">dicetbl</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c"># Make a table with one row, chosen at random from dicetbl</span>
    <span class="n">roll</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="s">'roll'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">roll</span>
</pre></div></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we'll use this to write a function to simulate how someone is supposed to respond to the survey.  The argument to the function is their true answer; the function returns what they're supposed to tell the interview.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c"># 1 stands for 'yes', 0 stands for 'no'</span>
<span class="k">def</span> <span class="nf">respond</span><span class="p">(</span><span class="n">trueanswer</span><span class="p">):</span>
    <span class="n">roll</span> <span class="o">=</span> <span class="n">rollonedie</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">roll</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">-</span><span class="n">trueanswer</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">trueanswer</span>
</pre></div></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can try it.  Assume our true answer is 'no'; let's see what happens this time:</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">respond</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>1</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Of course, if you were to run it again, you might get a different result next time.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">respond</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0</pre></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">respond</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>1</pre></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">respond</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>0</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>OK, so this lets us simulate the behavior of one participant, using randomized response.  Let's simulate what happens if we do this with 10,000 respondents.  We're going to imagine asking 10,000 people whether they've ever sung a Justin Bieber song in teh shower.  We'll imagine there are <code>10000 * p</code> people whose true answer is "yes" and <code>10000 * (1-p)</code> whose true answer is "no", so we'll use one <code>for</code>-loop to simulate the behavior each of the first <code>10000 * p</code> people, and a second <code>for</code>-loop to simulate the behavior of the remaining <code>10000 * (1-p)</code>.  We'll collect all the responses in a table, appending each response to the table as we receive it.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">responses</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([[]],</span> <span class="p">[</span><span class="s">'response'</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="mi">10000</span><span class="p">)):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">respond</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">r</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="mi">10000</span><span class="p">)):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">respond</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">r</span><span class="p">])</span>
</pre></div></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">responses</span>
</pre></div></div></div>
<div class="output_html rendered_html output_subarea output_execute_result">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>response</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>0       </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>1       </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>1       </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>1       </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>1       </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>1       </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>1       </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>0       </td>
        </tr>
    </tbody>
        <tbody><tr>
            <td>1       </td>
        </tr>
    </tbody>
</table>
<p>... (9990 rows omitted)</p></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We get a giant table with 10,000 rows, one per simulated participant.  Let's build a histogram and look at how many "yes"s we got and how many "no"s.</p></div></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">responses</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div></div></div>
<div class="output_png output_subarea ">
<img src="../notebooks-images/Iteration_32_0.png"/></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">responses</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'response'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">num_rows</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>6345</pre></div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">responses</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s">'response'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">num_rows</span>
</pre></div></div></div>
<div class="output_text output_subarea output_execute_result">
<pre>3655</pre></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So we polled 10,000 people, and got back 3644 yes responses.</p>
<p><strong>Exercise for you:</strong> Based on these results, approximately what fraction of the population has truly sung a Justin Bieber song in the shower?</p>
<p>Take a moment with your partner and work out the answer.</p></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Summing-up">Summing up<a class="anchor-link" href="#Summing-up">¶</a></h2></div></div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This method is called "randomized response".  It is one way to poll people about sensitive subjects, while still protecting their privacy.  You can see how it is a nice example of randomness at work.</p>
<p>It turns out that randomized response has beautiful generalizations.  For instance, your Chrome web browser uses it to anonymously report feedback to Google, in a way that won't violate your privacy.  That's all we'll say about it for this semester, but if you take an upper-division course, maybe you'll get to see some generalizations of this beautiful technique.</p></div></div></div>